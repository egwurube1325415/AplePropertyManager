<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Refer a Client | Aple Property Manager</title>
  <link rel="stylesheet" href="./style.css"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
</head>
<script>
    document.addEventListener("DOMContentLoaded", () => {
      const form = document.getElementById("referralForm");
      if (!form) return;
    
      const showFeedback = (el, show) => {
        const group = el.closest(".group") || el.parentElement;
        const fb = group ? group.querySelector(".invalid-feedback") : null;
        if (fb) fb.style.display = show ? "block" : "none";
        el.classList.toggle("is-invalid", show);
        el.setAttribute("aria-invalid", show ? "true" : "false");
      };
    
      const isEmpty = (el) => {
        if (el.type === "checkbox" || el.type === "radio") return !el.checked;
        return !String(el.value || "").trim();
      };
    
      const validateField = (el) => {
        // Required + email format
        if (el.hasAttribute("required")) {
          if (isEmpty(el)) return false;
          if (el.type === "email") {
            const ok = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(el.value.trim());
            return ok;
          }
        }
        return true;
      };
    
      // Validate on submit
      form.addEventListener("submit", (e) => {
        e.preventDefault();
    
        const requiredEls = form.querySelectorAll("input[required], select[required], textarea[required]");
        let firstInvalid = null;
    
        requiredEls.forEach(el => {
          const ok = validateField(el);
          showFeedback(el, !ok);
          if (!ok && !firstInvalid) firstInvalid = el;
        });
    
        if (firstInvalid) {
          firstInvalid.scrollIntoView({ behavior: "smooth", block: "center" });
          firstInvalid.focus({ preventScroll: true });
          return; // stop submission until fixed
        }
    
        // ---- SUCCESS: handle your real submit here ----
        // Example:
        // fetch('/api/referrals', { method:'POST', body:new FormData(form) })
        //   .then(...)
        alert("Referral submitted successfully. Thank you!");
        form.reset();
        form.querySelectorAll(".invalid-feedback").forEach(fb => fb.style.display = "none");
        form.querySelectorAll(".is-invalid").forEach(el => el.classList.remove("is-invalid"));
      });
    
      // Live re-check after the user starts fixing fields (after first submit)
      form.querySelectorAll("input, select, textarea").forEach(el => {
        const handler = () => {
          if (!form) return;
          // Only start hiding after a field changes
          const ok = validateField(el);
          showFeedback(el, !ok && (document.activeElement !== el || isEmpty(el)));
          if (ok) showFeedback(el, false);
        };
        el.addEventListener("input", handler);
        el.addEventListener("change", handler);
        el.addEventListener("blur", handler);
      });
    });
    </script>
    
<body>

  <!-- Top bar -->
  <header class="topstrip">
    <button class="iconbtn" aria-label="Open menu">
      <span class="bar"></span><span class="bar"></span><span class="bar"></span>
    </button>
    <div class="brand">
      <img src="./images/logo.png" alt="Aple logo" height="32">
      <span>Aple Property Manager</span>
    </div>
    <nav class="actions">
      <a class="signin" href="./index.html">Home</a>
    </nav>
  </header>

  <!-- Drawer (same IDs so script.js works) -->
  <aside id="aple-drawer" class="drawer" role="dialog" aria-modal="true" aria-labelledby="drawer-title" aria-hidden="true">
    <div class="drawer-panel" role="navigation">
      <div class="drawer-head">
        <h2 id="drawer-title">Aple Property Manager</h2>
        <button id="drawer-close" class="iconbtn" aria-label="Close menu">âœ•</button>
      </div>
      <nav class="drawer-nav">
        <a href="./index.html" class="drawer-link">Home</a>
        <a href="./about.html" class="drawer-link">About</a>
        <a href="./home.html" class="drawer-link">Services</a>
        <a href="./contact.html" class="drawer-link">Contact</a>
        <a href="./referral.html" class="drawer-cta">Refer a Client</a>
      </nav>
      <div class="drawer-foot"><small>Â© <span id="drawerYear"></span> Aple Property Manager</small></div>
    </div>
    <div class="drawer-backdrop" tabindex="-1"></div>
  </aside>

  <!-- HERO with video -->
  <section class="page-hero video-hero">
    <video class="hero-video" autoplay muted playsinline loop poster="./assets/apm11.jpg">
      <source src="./assets/apmReferral.mp4" type="video/mp4"/>
    </video>
  
    <div class="overlay"></div>
  
    <!-- NOTE the center class on page-hero-inner -->
    <div class="page-hero-inner center">
      <h1 class="title">Refer a Client</h1>
  
      <!-- Centered subtitle -->
      <p class="subtitle subtitle-chip">
        Help someone stabilize â€” earn up to <strong>$100</strong> per successful placement.
      </p>
  
      <a class="cta-btn cta-light" href="#form">Start Referral</a>
    </div>
  </section>
  

  <main class="page-wrap">

    <!-- Incentive & how it works -->
    <section class="section grid-3">
      <article class="card">
        <h2>Why refer to Aple?</h2>
        <p>Fast placements, clean and quiet homes, documentation support, and locations near transit & downtown. Housing firstâ€”dignity always.</p>
      </article>
      <article class="card">
        <h2>Earn up to $100</h2>
        <p>When your referral moves in and remains in good standing after the minimum stay, referrers can earn up to <strong>$100</strong>. Terms apply (see form).</p>
      </article>
      <article class="card">
        <h2>Who can refer?</h2>
        <p>Case managers, social workers, nonprofits, VA/hospitals, community orgsâ€”and caring neighbors who want to help.</p>
      </article>
    </section>

    <section class="aple-section" id="form">
        <div class="container" style="max-width:1100px;margin:0 auto;padding:0 16px;">
          
          <div class="aple-alert mb-3">
            Help someone stabilize â€” earn up to <strong>$100</strong> per successful placement. Terms apply.
          </div>
      
          <div class="aple-card">
            <h2 class="aple-title">Referral Questionnaire</h2>
            <p class="aple-subtle mb-3">2â€“3 minutes. The more detail you share, the faster we can place.</p>
      
            <!-- keep your existing form, just add some .row/.col wrappers for layout -->
            <form id="referralForm">
                <div class="row g-3">
                  <!-- Your name -->
                  <div class="col-md-6">
                    <div class="group">
                      <label class="form-label">Your name*</label>
                      <input class="form-control" name="refName" required>
                      <small class="error-message text-danger" style="display:none;">Please enter your name.</small>
                    </div>
                  </div>
              
                  <!-- Role/Organization -->
                  <div class="col-md-6">
                    <div class="group">
                      <label class="form-label">Role/Organization</label>
                      <input class="form-control" name="refRole"
                             placeholder="Case manager, VA, nonprofit, friendâ€¦">
                    </div>
                  </div>
              
                  <!-- Email -->
                  <div class="col-md-6">
                    <div class="group">
                      <label class="form-label">Email*</label>
                      <input class="form-control" type="email" name="refEmail" required>
                      <small class="error-message text-danger" style="display:none;">A valid email is required.</small>

                    </div>
                  </div>
              
                  <!-- Phone -->
                  <div class="col-md-6">
                    <div class="group">
                      <label class="form-label">Phone*</label>
                      <input class="form-control" name="refPhone" required>
                      <small class="error-message text-danger" style="display:none;">Please include a phone number.</small>
                    </div>
                  </div>
              
                  <!-- Client name -->
                  <div class="col-md-6">
                    <div class="group">
                      <label class="form-label">Client name*</label>
                      <input class="form-control" name="clientName" required>
                      <small class="error-message text-danger" style="display:none;">Client name is required.</small>
                    </div>
                  </div>
              
                  <!-- Target niche -->
                  <div class="col-md-6">
                    <div class="group">
                      <label class="form-label">Target niche*</label>
                      <select class="form-select" name="targetNiche" required>
                        <option value="">Selectâ€¦</option>
                        <option>Justice-involved (re-entry)</option>
                        <option>Recovery / Substance use</option>
                        <option>Veteran</option>
                        <option>Senior</option>
                        <option>SSI recipient</option>
                        <option>Other</option>
                      </select>
                      <small class="error-message text-danger" style="display:none;">Choose one option.</small>
                    </div>
                  </div>
                </div>
              
                <!-- the rest of your fields go underneath as full-width rows: -->
                <div class="row g-3 mt-2">
                  <div class="col-md-6">
                    <div class="group">
                      <label class="form-label">Desired housing*</label>
                      <select class="form-select" name="desiredHousing" required>
                        <option value="">Chooseâ€¦</option>
                        <option>Bed space</option>
                        <option>Private room</option>
                        <option>Whole unit</option>
                      </select>
                      <small class="error-message text-danger" style="display:none;">Select a housing type.</small>
                    </div>
                  </div>
              
                  <div class="col-md-6">
                    <div class="group">
                      <label class="form-label">Move-in window</label>
                      <input class="form-control" name="moveWindow" placeholder="e.g., within 2 weeks">
                    </div>
                  </div>
              
                  <div class="col-md-6">
                    <div class="group">
                      <label class="form-label">Income/Benefits</label>
                      <input class="form-control" name="incomeBenefits"
                             placeholder="Employment, SSI, VA, other">
                    </div>
                  </div>
              
                  <div class="col-md-6">
                    <div class="group">
                      <label class="form-label">Accessibility / special needs</label>
                      <input class="form-control" name="accessNeeds"
                             placeholder="Ground floor, ADA, etc.">
                    </div>
                  </div>
              
<div class="row g-3 mt-3">
    <!-- Supervision / reporting needs -->
    <div class="col-md-6">
      <div class="group">
        <label class="form-label">Supervision / reporting needs</label>
        <input
          class="form-control"
          name="supervisionNeeds"
          placeholder="Parole/probation, VA, court, none"
        >
      </div>
    </div>
  
    <!-- Notes -->
    <div class="col-md-6">
      <div class="group">
        <label class="form-label">Notes</label>
        <textarea
          class="form-control"
          name="notes"
          rows="4"
          placeholder="Anything we should know to place quickly?"
        ></textarea>
      </div>
    </div>
  
    <!-- Consent checkbox -->
    <div class="col-12 mt-2">
      <div class="form-check">
        <input
          id="consent"
          class="form-check-input"
          type="checkbox"
          name="consent"
          required
        >
        <label class="form-check-label" for="consent">
          I have the clientâ€™s permission to share this information for housing placement.
        </label>
        <small class="error-message text-danger" style="display:none;">Consent is required.</small>
      </div>
    </div>
  
    <!-- Submit button -->
    <div class="col-12 mt-3">
      <div class="d-grid d-md-flex justify-content-md-end">
        <button type="submit" class="btn aple-btn w-auto px-4 py-2">
            Submit Referral
          </button>          
      </div>
      <p id="referralNote" class="aple-subtle mt-2 fw-semibold"></p>
    </div>
  </div>
              </form>
              
          </div>
        </div>
      </section>
      
   
    <!-- Visual band / trust -->
    <section class="lp-section lp-gallery">
      <div class="lp-wrap">
        <h2 class="lp-title">Building Stability Through Community Partnerships</h2>
        <p class="lp-subtitle">We work alongside re-entry programs, veteran services, and nonprofits to provide stable, supportive housing for every individual who needs a fresh start.</p>
        
        <!-- Replace your current gallery wrapper -->
<div id="partnersRow">
    <figure class="partner-card">
      <img src="./assets/apm8.jpg" alt="Partners 1">
      <figcaption>Partnering with nonprofits & re-entry programs</figcaption>
    </figure>
  
    <figure class="partner-card">
      <img src="./assets/apm9.jpg" alt="Partners 2">
      <figcaption>Supporting veterans, seniors, and recovery clients</figcaption>
    </figure>
  
    <figure class="partner-card">
      <img src="./assets/apm10.jpg" alt="Partners 3">
      <figcaption>Collaborating with social service & community agencies</figcaption>
    </figure>
  </div>
  
      </div>
    </section>

    <!-- Reassurance strip -->
    <section class="reassure">
      <div class="reassure-overlay"></div>
      <div class="reassure-content">
        <h3>Everything Included</h3>
        <p>All packages include utilities, in-unit washer & dryer, high-speed internet, and 24/7 security in gated communities near bus routesâ€”minutes from downtown.</p>
      </div>
    </section>

  </main>

  <footer class="alt-footer">
    <p>Â© <span id="year"></span> Aple Property Manager LLC. All rights reserved.</p>
  </footer>

  <script>
    document.getElementById("referralForm").addEventListener("submit", function(e) {
        e.preventDefault(); // Stop form for validation
    
        let isValid = true;
    
        // Grab all required fields
        const requiredFields = document.querySelectorAll("#referralForm [required]");
    
        requiredFields.forEach(field => {
            const errorMsg = field.parentElement.querySelector(".error-message");
    
            // If no error message element exists, skip
            if (!errorMsg) return;
    
            if (field.value.trim() === "") {
                errorMsg.style.display = "block";
                isValid = false;
            } else {
                errorMsg.style.display = "none";
            }
        });
    
        // If fields invalid â†’ stop here
        if (!isValid) {
            return;
        }
    
        // If everything valid â†’ send form
        document.getElementById("referral-success").style.display = "block";
    
        // OPTIONAL: clear the form after submit
        document.getElementById("referralForm").reset();
    
        // Hide all error messages
        document.querySelectorAll(".error-message").forEach(msg => {
            msg.style.display = "none";
        });
    });
    </script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
          const form = document.getElementById("referralForm");
          const successModalEl = document.getElementById("referralSuccessModal");
          const successOkBtn = document.getElementById("referralSuccessOk");
        
          // ðŸ‘‰ Use ONE webhook URL â€“ make sure this is the same script you use for Contact
          const WEBHOOK = "https://script.google.com/macros/s/AKfycbxRkdfbDQhOeRXdW93KVC1K6FbZZl80nIViPRI4REdS4sXSAG_6BD5DLrydW0ORbdMk8Q/exec";
        
          // Bootstrap 5 modal instance (if present)
          const successModal = successModalEl ? new bootstrap.Modal(successModalEl) : null;
        
          // Handle form submit
          form.addEventListener("submit", async (e) => {
            e.preventDefault(); // stop browser default submit
        
            // Native HTML5 validation
            if (!form.checkValidity()) {
              form.classList.add("was-validated");
              return;
            }
        
            try {
              await sendReferral(form);
        
              // On success: show modal or fallback alert
              if (successModal) {
                successModal.show();
              } else {
                alert("Referral submitted! Thank you.");
                resetReferralForm(form);
              }
            } catch (err) {
              console.error("Error sending referral:", err);
              alert("Sorryâ€”could not submit the referral. Please try again.");
            }
          });
        
          // When user clicks OK on the success modal:
          if (successOkBtn && successModal) {
            successOkBtn.addEventListener("click", () => {
              successModal.hide();
              resetReferralForm(form);
            });
          }
        
          // ---- Helpers ----
        
          // Build payload sent to Apps Script
          function buildReferralPayload(form) {
            return {
              form: "referral",   // tells Apps Script to use handleReferral
        
              refName: form.refName.value.trim(),
              refRole: form.refRole.value.trim(),
              refEmail: form.refEmail.value.trim(),
              refPhone: form.refPhone.value.trim(),
        
              clientName: form.clientName.value.trim(),
              targetNiche: form.targetNiche.value.trim(),
              desiredHousing: form.desiredHousing.value.trim(),
              moveWindow: form.moveWindow.value.trim(),
              incomeBenefits: form.incomeBenefits.value.trim(),
              supervisionNeeds: form.supervisionNeeds.value.trim(),
              accessNeeds: form.accessNeeds.value.trim(),
              notes: form.notes.value.trim(),
              consent: form.consent.checked,
              hp: (form.hp?.value || "").trim() // honeypot
            };
          }
        
          // Send referral to Apps Script
          async function sendReferral(form) {
            const payload = buildReferralPayload(form);
        
            // For debugging, you can temporarily log this:
            // console.log("Sending referral payload:", payload);
        
            await fetch(WEBHOOK, {
              method: "POST",
              mode: "no-cors",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload)
            });
          }
        
          // Completely clear form + validation state
          function resetReferralForm(form) {
            // Clear values
            form.reset();
        
            // Remove Bootstrap validation classes
            form.classList.remove("was-validated");
            form.querySelectorAll(".is-invalid, .is-valid").forEach(el => {
              el.classList.remove("is-invalid", "is-valid");
              el.removeAttribute("aria-invalid");
            });
        
            // Hide any manual error/feedback text
            form.querySelectorAll(".invalid-feedback, .error-message").forEach(el => {
              el.style.display = "none";
            });
          }
        });
        </script>
  <script src="./script.js"></script>
</body>
</html>
